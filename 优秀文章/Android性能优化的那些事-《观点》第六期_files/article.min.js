/*uglify*/
function Hashtable(){this._hash=new Object,this.put=function(a,b){return void 0!==a&&(0==this.containsKey(a)&&(this._hash[a]=void 0===b?null:b,!0))},this.remove=function(a){delete this._hash[a]},this.size=function(){var a=0;for(var b in this._hash)a++;return a},this.get=function(a){return this._hash[a]},this.containsKey=function(a){return void 0!==this._hash[a]},this.clear=function(){for(var a in this._hash)delete this._hash[a]}}function AnalyticEmotion(a){if(void 0!==a){var b=a.match(/\[.*?\]/g);if(!b)return a;for(var c=0;c<b.length;c++)if(uSinaEmotionsHt.containsKey(b[c])){var d="<img style='display:inline;' alt=\"AnalyticEmotionsArr["+c+']" src="'+uSinaEmotionsHt.get(b[c])+'" height="22" width="22" />';a=a.replace(b[c],d)}for(var c=0;c<b.length;c++)a=a.replace("AnalyticEmotionsArr["+c+"]",b[c])}return a}function bindDelete(){$(".comment-f .delete").click(function(a){a.preventDefault(),a.stopPropagation(),$(".sureToDelete").slideUp(200),$(".cor").css("visibility","hidden"),$(this).children(".cor").css("visibility","visible"),$(this).children(".sureToDelete").slideDown(200);var b=$(this).children(".sureToDelete").css("width"),c=parseInt(b)/2-parseInt(b)-5;$(this).children(".sureToDelete").css("left",c+"px"),$(".cancel").click(function(a){a.preventDefault(),a.stopPropagation(),$(this).parents(".delete").children(".sureToDelete").slideUp(200),$(this).parents(".delete").children(".cor").css("visibility","hidden")})}),$(".sure").click(function(a){a.preventDefault();var b=$(this),c=$(this).parent("div").parent("a").attr("href");$.get(c,function(a){if(a.success){turnToPage(1);var b=$(".comment-total-count em").text();$(".comment-total-count em").text(parseInt(b)-1)}})})}function editCommentHandler(a){var b=$(this).parents(".comment-item"),c=b.find(".text-comment"),d=$.trim(c.html()),e=b.find(".comment-f");c.hide(),e.hide(),$(createEditAction()).appendTo(c.parent()).focus(),b.find(".multiple-edit").val(d).focus(),b.on("click",".edit-action-cancel",function(){cancelModify(b)}),b.on("click",".edit-action-done",doneModify)}function cancelModify(a){a.find(".edit-container").remove(),a.find(".comment-f").show(),a.find(".text-comment").show()}function doneModify(a){var b=$(this).parents(".comment-item"),c=b.attr("cid"),d=b.find(".multiple-edit").val(),e={commentId:c,content:d};$.post("/artEdit/modify",e,function(a){a.success?(console.log(1111111),b.find(".text-comment").html(d),cancelModify(b)):$FAM.fns.productAlert("修改评论失败~")})}function createEditAction(a){return'<div class="edit-container"><textarea type="text" spellcheck="false" autocomplete="off" class="multiple-edit" ></textarea><div class="edit-action"><span class="edit-action-cancel">取消</span><span class="edit-action-done">提交</span></div></div>'}var emotions=new Array,categorys=new Array,uSinaEmotionsHt=new Hashtable;$(function(){$.ajax({dataType:"jsonp",url:"https://api.weibo.com/2/emotions.json?source=1362404091",success:function(a){var b=a.data;for(var c in b)""==b[c].category&&(b[c].category="默认"),void 0==emotions[b[c].category]&&(emotions[b[c].category]=new Array,categorys.push(b[c].category)),emotions[b[c].category].push({name:b[c].phrase,icon:b[c].icon}),uSinaEmotionsHt.put(b[c].phrase,b[c].icon)}})}),function(a){a.fn.SinaEmotion=function(b){function c(){var b=arguments[0]?arguments[0]:0;if(!(b<0||b>=categorys.length/5)){a("#emotions .categorys").html(""),f=b;for(var c=5*b;c<5*(b+1)&&c<categorys.length;++c)a("#emotions .categorys").append(a('<a href="javascript:void(0);">'+categorys[c]+"</a>"));a("#emotions .categorys a").click(function(){d(a(this).text())}),a("#emotions .categorys a").each(function(){a(this).text()==e&&a(this).addClass("current")})}}function d(){var c=arguments[0]?arguments[0]:"默认",f=arguments[1]?arguments[1]-1:0;a("#emotions .container").html(""),a("#emotions .page").html(""),e=c;for(var g=72*f;g<72*(f+1)&&g<emotions[c].length;++g)a("#emotions .container").append(a('<a href="javascript:void(0);" title="'+emotions[c][g].name+'"><img src="'+emotions[c][g].icon+'" alt="'+emotions[c][g].name+'" width="22" height="22" /></a>'));a("#emotions .container a").click(function(){b.insertText(a(this).attr("title")),a("#emotions").remove()});for(var g=1;g<emotions[c].length/72+1;++g)a("#emotions .page").append(a('<a href="javascript:void(0);"'+(g==f+1?' class="current"':"")+">"+g+"</a>"));a("#emotions .page a").click(function(){d(c,a(this).text())}),a("#emotions .categorys a.current").removeClass("current"),a("#emotions .categorys a").each(function(){a(this).text()==c&&a(this).addClass("current")})}var e,f;a(this).click(function(e){e.stopPropagation();var g=b.offset().top+b.height()+25,h=b.offset().left-1;if(a("#emotions .categorys")[0])return a("#emotions").css({top:g,left:h}),void a("#emotions").toggle();a("body").append('<div id="emotions"></div>'),a("#emotions").css({top:g,left:h}),a("#emotions").html("<div>正在加载，请稍候...</div>"),a("#emotions").click(function(a){a.stopPropagation()}),a("#emotions").html('<div style="float:right"><a href="javascript:void(0);" id="prev">&laquo;</a><a href="javascript:void(0);" id="next">&raquo;</a></div><div class="categorys"></div><div class="container"></div><div class="page"></div>'),a("#emotions #prev").click(function(){c(f-1)}),a("#emotions #next").click(function(){c(f+1)}),c(),d()}),a("body").click(function(){a("#emotions").remove()}),a.fn.insertText=function(a){return this.each(function(){if("INPUT"===this.tagName||"TEXTAREA"===this.tagName)if(document.selection){this.focus();var b=document.selection.createRange();b.text=a,b.collapse(),b.select()}else if(this.selectionStart||"0"==this.selectionStart){var c=this.selectionStart,d=this.selectionEnd;this.value=this.value.substring(0,c)+a+this.value.substring(d,this.value.length),this.selectionStart=this.selectionEnd=c+a.length}else this.value+=a}),this}}}(jQuery),function(a,b){a(document).ready(function(){function b(a,b,d,e){var f=a.css(b);c(function(){var c=a.css(b);e(f,c,function(){a.css(b,f)})},d)}function c(a,b){var c=setTimeout,d=null,e=function(){d=c(function(){a.call(null),c(e,b)},b)};return c(e,b),d}function d(){var b=a(".comment-total-count").find("em"),c=parseInt(b.text(),10);b.text(c+1)}function e(){a(".upload-img").hide(),a(".filebtn").show(),a(".img-preview").remove()}function f(a,b){return a.html().replace(/<[^>]+>/g,"").replace(/(^\s+)|(\s+$)/g,"").slice(0,b)+"......"}function g(a,b,c){if(a.createTextRange){var d=a.createTextRange();d.moveStart("character",b),d.moveEnd("character",c),d.select()}else a.setSelectionRange(b,c),a.focus()}var h=a("#WATERMARK").val(),i=a(".container");h='url("'+h+'")',i.css("background",h),b(i,"background",500,function(b,c,d){c!=b&&(a.get("/watermark?attr="+c),d())});var j=a(".operation"),k=j.find(".favorite"),l=j.find(".agree"),m=a("#article-title").attr("data-id"),n=a(".comment-link"),o=a(".main").attr("data"),p=a(".article-comment"),q=a("#J-textarea"),r=a("#comment-form"),s=a(".comment-f .rel");a('input[name="searchWord"]').flg({placeholder:"搜索主题，专区"});var t=a(".email-prefix"),u=t.width(),v=t.height(),w=t.text();a(".comment_search").size()||"true"===o&&a.post("/asyncComment",{articleId:m},function(b){a(".comment-wrap").html(b),ShowPageBar("pageBar","",{style:"simpleBlue",mark:"",totalCount:parseInt(a('input[name="commentCount"]').val()),showPageNumber:3,pageCount:parseInt(a('input[name="pageSize"]').val()),currentPageIndex:parseInt(a('input[name="pageNum"]').val())||1,noRecordTip:"没有记录",preWord:"上一页",nextWord:"下一页",onclick:"window.turnToPage({pageindex});return false;"})}),ShowPageBar("pageBar","",{style:"simpleBlue",mark:"",totalCount:parseInt(a('input[name="commentCount"]').val()),showPageNumber:3,pageCount:parseInt(a('input[name="pageSize"]').val()),currentPageIndex:parseInt(a('input[name="pageNum"]').val())||1,noRecordTip:"没有记录",preWord:"上一页",nextWord:"下一页",onclick:"window.turnToPage({pageindex});return false;"}),k.on({click:function(b){var c=a(this),d=c.attr("data-favorite"),e={articleId:m},f=c.find("span");"un"===d?a.post("/favorite",e,function(a){a.success&&(f.text("已收藏"),c.attr("data-favorite","ed"),c.removeClass(d).addClass("ed"))}):"ed"===d&&a.post("/cancelFavorite",e,function(a){a.success&&(f.text("收藏"),c.attr("data-favorite","un"),c.removeClass(d).addClass("un"))})},mouseenter:function(){var b=a(this),c=b.attr("data-favorite"),d=b.find("span");"ed"===c&&d.text("取消")},mouseleave:function(){var b=a(this),c=b.attr("data-favorite"),d=b.find("span");"ed"===c&&d.text("已收藏")}}),l.on("click",function(){var b=a(this),c=b.attr("data-agree"),d={articleId:m},e=b.find("em");"un"===c?a.post("/agree",d,function(a){a.success&&(a.data?e.text(a.data):e.text(""),b.attr("data-agree","ed"),b.addClass("ed").toggleClass(c))}):"ed"===c&&a.post("/cancelAgree",d,function(a){a.success&&(b.attr("data-agree","un"),a.data?e.text(a.data):e.text(""),b.addClass("un").toggleClass(c))})}),p.on("click",".img-item img",function(){a(this).parent().toggleClass("big")}),n.click(function(){var b=a(".comment-area"),c=b.find("textarea");a(window).scrollTo(b.position().top),c.focus()});var x=a(".avatar"),y=x.find(".user-info");x.hover(function(){y.hasClass("loaded")?y.show():a.post("/getProductUserInfo",{},function(a){y.html(a),y.addClass("loaded"),y.show()})},function(){y.hide()}),p.on("click",".comment-f span.rel",function(){var b=a(this),c=b.attr("data-id"),d=b.attr("data-name"),e=p.find("#J-textarea"),f=e.offset().left,h=e.offset().top;a('input[name="replyToComment"]').val(c),a(window).scrollTo(h),e.val("回复"+d+"：");var i=e[0],j=i.value.length,k=i.value.length,l=i.value;e.attr({length:k,content:l}),g(i,j,k)}),p.on("click",".submit-btn",function(){var b=a(this),c=b.parent().find("textarea"),f=c.val(),g=c.attr("content"),h=c.attr("length");if(!a.trim(c.val())&&!a(".img-preview").length)return c.focus(),!1;if(a.trim(f).length>2e3)return alert("评论字数大于2000字，请修改"),!1;f.slice(0,h)!==g&&a('input[name="replyToComment"]').val("");var i=c.val(),j=AnalyticEmotion(i);a('textarea[name="content"]').val(j),a.post("/addComment",r.serialize(),function(a){a.status?(turnToPage(1),c.val(""),d(),e(),bindDelete()):$FAM.fns.productAlert(a.msg)})});var z=a(".article-content");a(".share-hi").click(function(){var b=a(this),c=b.attr("data-pic")||z.find("img").attr("src")||"",d=b.attr("data-title")||"",e=b.attr("data-desc")||f(z,40)||"",g={resourceUrl:window.location.href,pic:c,title:d,description:e,tip:""};shareOnclick(g)});var A=a(".hide-comment-open");p.on("click",".hide-comment-open",function(){var b=a(this).find("i"),c=a(this).parent(),d=a(this).hasClass("visited"),e=b.hasClass("up"),f=a(this).attr("data-replyId"),g=c.find(".replyTo"),h=c.find(".replyTo-hide");d?e?(a(this).find("span").html("展开全部评论"),b.removeClass("up"),h.hide()):(a(this).find("span").html("收起"),b.addClass("up"),h.show()):(a.post("/commentReply",{commentId:f},function(a){if(a.success){var a=a.data,c="<div><p>"+a.author+"</p><p>"+a.content+"<p/></div>";if(a.replyTo&&a.replyTo.length)for(var d=0;d<a.replyTo.length;d++)c+="<div><p>"+a.replyTo[d].author+"</p><p>"+a.replyTo[d].content+"<p/></div>";b.addClass("up"),h.html(c)}}),a(this).find("span").html("收起"),a(this).addClass("visited"))}),a(".face>a").SinaEmotion(q),a("#comment-form textarea").at("@"),a("#comment-form textarea").bind({focus:function(){a(this).addClass("focus")},blur:function(){a(this).removeClass("focus")}}),a(".at").click(function(){var b=a.trim(q.val());b?q.val(b+"@请输入邮箱前缀"):(q.val("@请输入邮箱前缀"),q.focus());var c=q.val().length,d=c-7;g(q[0],d,c)});var B=a(".upload-img"),C=a(".picture"),D=a(".close-icon",B);C.bind("click",function(){B.show()}),D.bind("click",function(){return B.hide(),!1}),window.turnToPage=function(b){var c=m,d=a('input[name="pageSize"]').val(),e=a("#nameSearch").val()===a("#nameSearch").data("holder")?"":a("#nameSearch").val(),f={pageNo:b,articleId:c,keyword:e};a.post("/commentList",f,function(c){var d=a(".comment-wrap"),e=d.offset().top,f=d.offset().left;d.html(c),bindDelete(),window.scrollTo(f,e),ShowPageBar("pageBar","",{style:"simpleBlue",mark:"",totalCount:parseInt(a('input[name="commentCount"]').val()),showPageNumber:3,pageCount:parseInt(a('input[name="pageSize"]').val()),currentPageIndex:parseInt(b),noRecordTip:"没有记录",preWord:"上一页",nextWord:"下一页",onclick:"window.turnToPage({pageindex});return false;"})})}})}(jQuery,void 0),$(".nameSearch").focus(function(){this.value===$(this).data("holder")&&(this.value="")}),$(".nameSearch").blur(function(){""===this.value&&"text"===this.type&&(this.value=$(this).data("holder"))}),window.onload=function(){if(window.location.search){var a=$(".comment_search").get(0).offsetTop;window.scrollTo(0,a+93)}},$("body").click(function(){$(".sureToDelete").slideUp(200),$(".cor").css("visibility","hidden")}),bindDelete();var submit=!1;$("#searchComment").click(function(a){if(a.preventDefault(),!submit){submit=!0;var b={keyword:$("#nameSearch").val()===$("#nameSearch").data("holder")?"":$("#nameSearch").val(),articleId:$("#article-title").attr("data-id")};$.post("/commentList",b,function(a){a&&(submit=!1,$(".comment-wrap").html(a),bindDelete(),ShowPageBar("pageBar","",{style:"simpleBlue",mark:"",totalCount:parseInt($('input[name="commentCount"]').val()),showPageNumber:3,pageCount:parseInt($('input[name="pageSize"]').val()),currentPageIndex:parseInt($('input[name="pageNum"]').val())||1,noRecordTip:"没有记录",preWord:"上一页",nextWord:"下一页",onclick:"window.turnToPage({pageindex});return false;"}))})}}),$("#output").click(function(a){a.preventDefault();var b={keyword:$("#nameSearch").val()===$("#nameSearch").data("holder")?"":$("#nameSearch").val(),articleId:$("#article-title").attr("data-id")};$.get("/artEdit/exportCommentList",b,function(a){var b=[],c=a.data;for(var d in a.data)b.push(d+"="+c[d]);var e=b.join("&");window.open("/export?"+e)})}),$("#article-comment").on("click",".edit-comment",editCommentHandler),$("#article-comment").on("click",".top-comment",function(a){var b=$(this),c=$(this).parents(".comment-item"),d=b.text(),e="置顶"!==d,f=c.attr("cid");$.post("/artEdit/topComment",{commentId:f,cancel:e},function(a){a.success?e?b.text("置顶"):b.text("取消置顶"):e?$FAM.fns.productAlert("取消置顶评论失败~"):$FAM.fns.productAlert("置顶评论失败~")})}),$("#article-comment").on("dblclick",".text-comment",editCommentHandler),function(a,b){var c=5,d=d||{};d={onStart:function(){a(".filebtn .add-file").addClass("loading-icon")},onProgress:function(){},onUploadSuccess:function(b,c){var d=a(".upload-wrapper li"),e=a(".filebtn"),f='<li class="img-preview" data-id="'+b.id+'" data-size="'+parseInt(b.size/1024)+'KB"><img src="'+c.url+'" /><span class="mask-img"></span><i class="icons del-file"></i><input type="hidden" name="imageSrc" value="'+c.url+'" /></li>';e.before(f),d.size()>=5&&a(".filebtn").hide()},onSelectError:function(a,b,c){-110===b&&$FAM.fns.productAlert("上传失败,请上传小于10M的图片")},onUploadError:function(a,b,c){},onUploadComplete:function(){a(".filebtn .add-file").removeClass("loading-icon")}},a(".upload-wrapper").on("click",".del-file",function(){var b=a(this),d=b.parent().attr("data-id");a.post("product/delFile",{id:d},function(d){d.success&&(b.parent().remove(),a(".filebtn").show(),c++,a("#uploadBtn").uploadify("settings","uploadLimit",c))})}),a("#commentUploadBtn").fileupload({iframe:/msie\s9\./g.test(navigator.userAgent.toLowerCase()),dataType:"text",url:"http://"+b.location.host+"/uploadFile",change:d.onStart,add:function(a,b){var c=b.files[0];return/\.(png|jpe?g|gif)$/gi.test(c.name)?c.size>5e6?($FAM.fns.showMessage("请上传小于5M的的图片 ！"),void d.onUploadComplete()):void b.submit():($FAM.fns.showMessage("请上传jpg jpeg png gif格式的图片 ！"),void d.onUploadComplete())},done:function(a,b){d.onUploadSuccess(b.files[0],JSON.parse(b.result)),d.onUploadComplete()},fail:function(a,b){$FAM.fns.showMessage("上传失败 ! ")}})}(jQuery,window);
//# sourceMappingURL=article.min.js.map